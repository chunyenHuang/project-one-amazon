// Prodcuts Details
// csj = cloth, shoes & jewelry
var products = [{
  id: 1,
  name: "Dream shoes",
  price: 45,
  description: randomText(150),
  condition: 'New',
  thumbOne: 'images/products/product-01.jpg',
  category: 'csj',
  tag: ['shoes']
}, {
  id: 2,
  name: "Metal Chain Flats Thick Sole Shoes Sneakers shoes",
  price: 30,
  description: randomText(150),
  condition: 'New',
  thumbOne: 'images/products/product-02.jpg',
  category: 'csj',
  tag: ['shoes']
}, {
  id: 3,
  name: "EpicStep Women's k Sole Shoes Sneakers shoes",
  price: 30,
  description: randomText(150),
  condition: 'New',
  thumbOne: 'images/products/product-03.jpg',
  category: 'csj',
  tag: ['shoes']
}, {
  id: 4,
  name: "dream dream dream",
  price: 28,
  description: randomText(150),
  condition: 'Old',
  thumbOne: 'images/products/product-04.jpg',
  category: 'csj',
  tag: ['shoes']
}, {
  id: 5,
  name: "Space Shoes for women",
  price: 63,
  description: randomText(150),
  condition: 'New',
  thumbOne: 'images/products/product-05.jpg',
  category: 'csj',
  tag: ['shoes']
}, {
  id: 6,
  name: "Cotton cloth blue green",
  price: 45,
  description: randomText(150),
  condition: 'New',
  thumbOne: 'images/products/product-06.jpg',
  category: 'csj',
  tag: ['fashion']
}, {
  id: 7,
  name: "High shoes sport",
  price: 150,
  description: randomText(150),
  condition: 'New',
  thumbOne: 'images/products/product-07.jpg',
  category: 'csj',
  tag: ['shoes']
}, {
  id: 8,
  name: "Hfashion jewelry pendant",
  price: 70,
  description: randomText(150),
  condition: 'New',
  thumbOne: 'images/products/product-08.jpg',
  category: 'csj',
  tag: ['fashion', 'gift']
}, {
  id: 9,
  name: "No 9 shoes sport",
  price: 700,
  description: randomText(150),
  condition: 'New',
  thumbOne: 'images/products/product-09.jpg',
  category: 'csj',
  tag: ['shoes', 'sport']
}, {
  id: 10,
  name: "No 10 flower mask",
  price: 1000,
  description: randomText(150),
  condition: 'New',
  thumbOne: 'images/products/product-10.jpg',
  category: 'csj',
  tag: ['fashion']
}, {
  id: 11,
  name: "No 11 colorful paints",
  price: 340,
  description: randomText(150),
  condition: 'New',
  thumbOne: 'images/products/product-11.jpg',
  category: 'csj',
  tag: ['fashion', 'women', 'men']
}, {
  id: 12,
  name: "No 12 silver pendant",
  price: 300,
  description: randomText(150),
  condition: 'New',
  thumbOne: 'images/products/product-12.jpg',
  category: 'csj',
  tag: ['fashion', 'gift']
}, {
  id: 13,
  name: "coloful plastic bracelet bangle",
  price: 10,
  description: randomText(150),
  condition: 'New',
  thumbOne: 'images/products/product-13.jpg',
  category: 'csj',
  tag: ['fashion']
}, {
  id: 14,
  name: "nice shoes",
  price: 90,
  description: randomText(150),
  condition: 'New',
  thumbOne: 'images/products/product-14.jpg',
  category: 'csj',
  tag: ['shoes']
}, {
  id: 15,
  name: "leather watch really cool",
  price: 230,
  description: randomText(150),
  condition: 'New',
  thumbOne: 'images/products/product-15.jpg',
  category: 'csj',
  tag: ['electronics']
}, {
  id: 16,
  name: "red shoes nice",
  price: 80,
  description: randomText(150),
  condition: 'New',
  thumbOne: 'images/products/product-16.jpg',
  category: 'csj',
  tag: ['shoes']
}, {
  id: 17,
  name: "So cool sun glasses",
  price: 400,
  description: randomText(150),
  condition: 'New',
  thumbOne: 'images/products/product-17.jpg',
  category: 'csj',
  tag: ['fashion']
}, {
  id: 18,
  name: "cream polish",
  price: 4000,
  description: randomText(150),
  condition: 'New',
  thumbOne: 'images/products/product-18.jpg',
  category: 'beauty',
  tag: ['cosmetic']
}, {
  id: 19,
  name: "red jacket waterproof",
  price: 250,
  description: randomText(150),
  condition: 'New',
  thumbOne: 'images/products/product-19.jpg',
  category: 'csj',
  tag: ['sport']
}, {
  id: 20,
  name: "leather jacket",
  price: 40,
  description: randomText(150),
  condition: 'New',
  thumbOne: 'images/products/product-20.jpg',
  category: 'csj',
  tag: ['fashion']
}, {
  id: 21,
  name: "hat",
  price: 400,
  description: randomText(150),
  condition: 'New',
  thumbOne: 'images/products/product-21.jpg',
  category: 'csj',
  tag: ['fashion', 'women']
}, {
  id: 22,
  name: "No 22 ungly t-shirt",
  price: 332.2,
  description: randomText(150),
  condition: 'New',
  thumbOne: 'images/products/product-22.jpg',
  category: 'csj',
  tag: ['fashion', 'women', 't-shirt']
}, {
  id: 23,
  name: "cool watch",
  price: 410,
  description: randomText(150),
  condition: 'New',
  thumbOne: 'images/products/product-23.jpg',
  category: 'electronics',
  tag: ['electronics']
}, {
  id: 24,
  name: "leather watch",
  price: 20,
  description: randomText(150),
  condition: 'New',
  thumbOne: 'images/products/product-24.jpg',
  category: 'electronics',
  tag: ['electronics']
}, {
  id: 25,
  name: "watch so nice",
  price: 90,
  description: randomText(150),
  condition: 'New',
  thumbOne: 'images/products/product-25.jpg',
  category: 'electronics',
  tag: ['electronics']
}, {
  id: 26,
  name: "really cool phone",
  price: 2200,
  description: randomText(150),
  condition: 'New',
  thumbOne: 'images/products/product-26.jpg',
  category: 'electronics',
  tag: ['electronics']
}, {
  id: 27,
  name: "colorful purse",
  price: 700,
  description: randomText(150),
  condition: 'New',
  thumbOne: 'images/products/product-27.jpg',
  category: 'csj',
  tag: ['fashion', 'women']
}, {
  id: 28,
  name: "cool iphone contaier",
  price: 340,
  description: randomText(150),
  condition: 'New',
  thumbOne: 'images/products/product-28.jpg',
  category: 'csj',
  tag: ['gift', 'electronics']
}, {
  id: 29,
  name: "Purse black for nothing",
  price: 80,
  description: randomText(150),
  condition: 'New',
  thumbOne: 'images/products/product-29.jpg',
  category: 'csj',
  tag: ['fashion']
}, {
  id: 30,
  name: "lots of purses",
  price: 90,
  description: randomText(150),
  condition: 'New',
  thumbOne: 'images/products/product-30.jpg',
  category: 'csj',
  tag: ['fashion']
}];
// Underscore
var seven = _.where(products, {id: 7})

// A fake user id
var users =[{
  id:1,
  name: ">>>Current User<<<  <<<<<<<<<<<<<<<< This guy is you!"
}]

// push random user
for (var i=2; i<=500;i++){
  var randomName = randomText(2);
  var addNewUser = new user(i, randomName);
  users.push(addNewUser);
}

function user(id, name){
  this.id = id;
  this.name = name
}

var currentUser = {
  id:1,
  name: ">>>Current User<<<  <<<<<<<<<<<<<<<< This guy is you!"
}

// reviews
var reviews=[];

function review(id, productId, rating, comment, date, userId){
  if(reviews.length==0){
    id = 1;
  } else {
    var last = _.last(reviews);
    id = last.id + 1;
  }
  this.id = id;
  this.productId = productId;
  this.rating = rating;
  this.comment = comment;
  this.date = date;
  this.userId = userId;
}

function randomText(length){
    var text = "";
    var paragraph = "";
    var possible = "abcdefghijklmnopqrstuvwxyz";
    var paragraphLength = Math.floor(Math.random() * (length)) + 1;
    for(var x=0; x < paragraphLength; x++){
      text = "";
      var textLength = Math.floor(Math.random() * (10)) + 3;
      for( var i=0; i < textLength; i++ ){
        text += possible.charAt(Math.floor(Math.random() * possible.length));
      }
      paragraph = paragraph + text + " ";
    }
    return paragraph;
}

// push a random reviews
var randomRating = Math.floor(Math.random() * (5)) + 1;
var randomeUser = _.sample(users, 1);
var randomYear = Math.floor(Math.random() * (8)) + 2008;
var randomMonth = Math.floor(Math.random() * (11)) + 1;
var randomDay = Math.floor(Math.random() * (29)) + 1;
var randomDate = new Date(randomYear, randomMonth, randomDay);

for (var i=1; i<=2000;i++){
  var randomProduct = _.sample(products, 1);
  var addNewReview = new review(0, randomProduct[0].id, randomRating , randomText(100), randomDate, randomeUser[0].id);
  reviews.push(addNewReview);
}
for (var i=1; i<=1000;i++){
  var samples = _.first(products, 5);
  var randomProduct = _.sample(samples, 1);
  var addNewReview = new review(0, randomProduct[0].id, 1 , randomText(100), randomDate, randomeUser[0].id);
  reviews.push(addNewReview);
}
for (var i=1; i<=1000;i++){
  var samples = _.last(products, 5);
  var randomProduct = _.sample(samples, 1);
  var addNewReview = new review(0, randomProduct[0].id, 5 , randomText(100), randomDate, randomeUser[0].id);
  reviews.push(addNewReview);
}

var mostReviews = _.chain(reviews).countBy("productId").pairs().sortBy(1).value().reverse();
console.log(mostReviews);

var reviewGroups = _(reviews).groupBy('productId');
console.log(reviewGroups);
var rankReviews = _.chain(reviewGroups).map(function(num, key){
  return {
          productId: key,
          rating: _(num).reduce(function(m,x){ return m + x.rating; }, 0)/num.length
         };
}).sortBy('rating').value().reverse();
console.log(rankReviews);

// tester
var data = [ { type: "A", val: 10 },
             { type: "B", val: 3 },
             { type: "A", val: 10 },
             { type: "C", val: 5 } ];

var groups = _(data).groupBy('type');

var out = _(groups).map(function(g, key) {
  return { type: key,
           total: _(g).reduce(function(m,x) { return m + x.val; }, 0)
          };
});
